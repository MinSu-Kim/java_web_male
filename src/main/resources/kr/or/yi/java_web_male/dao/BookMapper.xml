<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.yi.java_web_male.dao.BookMapper">

	<sql id="selectSql">
		select * from book
	</sql>
	
	<sql id="whereSql">
		<where>
			<if test="bookCode != null">
				book_code REGEXP#{bookCode}
			</if>
		</where>
	</sql>
	
	
	<select id="selectBookByAll" parameterType="Book"
		resultType="Book">
		<include refid="selectSql" />
	</select>
	
	<!-- updateSql -->
	<sql id="updateSql">
		update book set book_no=#{bookNo}, author=#{writter}, translator=#{translator}, title=#{title}, price=#{priece}, rental_possible=#{rentable}, image=#{image}, cate_s_no=#{categorynoS.categorynoS}, cate_m_no=#{categorynoM.categorynoM}, cate_b_no=#{categorynoB.categorynoB}, pub_no=#{publisherNo.publisherNo}
		WHERE book_code=#{bookCode};
	</sql>	
	
	<resultMap type="Book" id="Booktyepinsert">
		<id property="bookCode" column="book_code"/>
		<result property="bookNo" column="book_no"/>
		<result property="pubNo.pubNo" column="pub_no"/>
		<result property="author" column="author"/>
		<result property="translator" column="translator"/>
		<result property="title" column="title"/>
		<result property="image" column="image"/>
		<result property="price" column="price"/>
		<!-- <result property="rentalPossible" column="rental_possible"/> -->
		<result property="cateBNo.bCode" column="cate_b_no"/>
		<result property="cateMNo.mCode" column="cate_m_no"/>
		<result property="cateSNo.sCode" column="cate_s_no"/>		
	</resultMap>
	
	<select id="selectbookbybookCode" parameterType="Book"
		resultMap="Booktyepinsert">
		<include refid="selectSql" />
		<include refid="whereSql" />
	</select>
	
	<insert id="insertBook" parameterType="Book">
		INSERT INTO proj_library.book (book_code, book_no, pub_no, author, translator, title, price, rental_possible, image, cate_s_no, cate_m_no, cate_b_no)
		VALUES (#{bookCode},#{bookNo},#{publisherNo.publisherNo}, #{writter}, #{translator}, #{title}, #{priece}, #{rentable}, #{image}, #{categorynoS.categorynoS}, #{categorynoM.categorynoM}, #{categorynoB.categorynoB})
	</insert>
	
	<update id="updateBook" parameterType="Book">
		<include refid="updateSql" />
	</update>

</mapper>